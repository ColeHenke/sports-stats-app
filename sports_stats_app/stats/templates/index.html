{% extends "base.html" %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container my-4">
    <div class="text-center mb-3">
        <h2>Stats Table</h2>
        <div>
            <button onclick="window.location.reload()" class="btn btn-primary">Refresh</button>
        </div>
        <form action="{% url 'index' %}" method="post" class="d-flex justify-content-center gap-2 mt-3">
            {% csrf_token %}
            <button class="btn btn-primary" type="submit" name="by_name">By Name</button>
            <button class="btn btn-secondary" type="submit" name="by_points">Points</button>
            <button class="btn btn-success" type="submit" name="by_position">By Position</button>
        </form>
    </div>
    <table class="table table-striped table-hover" id="statsTable">
        <thead class="table-dark">
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Rank</th>
                <th scope="col">Position</th>
                <th scope="col">Points Per Game</th>
                <th scope="col">Rebounds Per Game</th>
            </tr>
        </thead>
        <tbody>
            {% for player in players %}
            <tr>
                <td>{{ player.full_name }}</td>
                <td>{{ player.rank }}</td>
                <td>{{ player.position }}</td>
                <td>{{ player.pts|floatformat:1 }}</td>
                <td>{{ player.reb|floatformat:1 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No players found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function sortTable(n) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;
    table = document.getElementById("statsTable");
    switching = true;
    dir = "asc"; // Set the sorting direction to ascending initially
    while (switching) {
      switching = false;
      rows = table.rows;
      for (i = 1; i < rows.length - 1; i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("TD")[n];
        y = rows[i + 1].getElementsByTagName("TD")[n];
        if (dir == "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        } else if (dir == "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount++;
      } else {
        if (switchcount == 0 && dir == "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>
{% endblock content %}